#summary Handling of Input Streams, File Type recognition

= Introduction =

DecoJer.decompile(stream)

= Details =

  * Java Classfile starts with magic number "CA FE BA BE"
  * ZIP (JAR, EAR, WAR) starts with "50 4B 03 04", zip entries are seperated through same signature
  * http://www.onicos.com/staff/iz/formats/zip.html
  * ZIP Central Directory on file end => but not used for Jar/ZipInputStream
  * ZIP embedded in ZIP possible (e.g. EAR), direct sub stream possible?

== Zip Order ==

Any order of ZIP entries possible, test:
{{{
			final ZipOutputStream os = new ZipOutputStream(new FileOutputStream(new File("...")));

			os.putNextEntry(new ZipEntry("test/test"));
			os.write("TEST".getBytes());

			os.putNextEntry(new ZipEntry("test2"));
			os.write("TEST2".getBytes());

			os.putNextEntry(new ZipEntry("test/test3"));
			os.write("TEST3".getBytes());

			os.putNextEntry(new ZipEntry("test/")); // is possible...

			os.finish();
}}}

And read:
{{{
			final ZipInputStream zip = new ZipInputStream(new FileInputStream(new File("...")));

			System.out.println("Mark Supported: " + zip.markSupported());

			for (ZipEntry zipEntry = zip.getNextEntry(); zipEntry != null; zipEntry = zip
					.getNextEntry()) {
				System.out.println("ZIP Entry: " + zipEntry);
			}
}}}

results in:
{{{
Mark Supported: false
ZIP Entry: test/test
ZIP Entry: test2
ZIP Entry: test/test3
ZIP Entry: test/
}}}

Duplicate names on write ("test3" => "test") result in:
{{{
java.util.zip.ZipException: duplicate entry: test/test
	at java.util.zip.ZipOutputStream.putNextEntry(ZipOutputStream.java:175)
	at org.decojer.ZipTests.main(ZipTests.java:58)
ZIP Entry: test/test
ZIP Entry: test2
}}}

== File Check Order ==
  * http://www.java2s.com/Tutorial/Java/0180__File/UnzipusingtheZipInputStream.htm
  *     static long LOCSIG = 0x04034b50L;	// "PK\003\004"

  * markSupported()? mark() => check ZIP magic
    * YES => open JarFile via Google FileService http://code.google.com/intl/de-DE/appengine/docs/java/javadoc/index.html?com/google/appengine/api/blobstore/package-summary.html
    * NO => reset() and new TD(is) => new javassist.bytecode.ClassFile() => OK or throws IOException("bad magic number...)